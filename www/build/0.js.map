{"version":3,"sources":["../../src/pages/validar-facturas/validar-facturas.module.ts","../../src/pages/validar-facturas/validar-facturas.ts"],"names":[],"mappings":"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","file":"0.js","sourcesContent":["import { NgModule } from '@angular/core';\r\nimport { IonicPageModule } from 'ionic-angular';\r\nimport { ValidarFacturasPage } from './validar-facturas';\r\n\r\n@NgModule({\r\n  declarations: [\r\n    ValidarFacturasPage,\r\n  ],\r\n  imports: [\r\n    IonicPageModule.forChild(ValidarFacturasPage),\r\n  ],\r\n})\r\nexport class ValidarFacturasPageModule {}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/validar-facturas/validar-facturas.module.ts","import { Factura } from '../../app/models/factura';\r\nimport { FirebaseServicePrivider } from '../../providers/firebase-service/firebase-service';\r\nimport { FirebaseListObservable, FirebaseObjectObservable, AngularFireDatabase } from 'angularfire2/database';\r\nimport { Component } from '@angular/core';\r\nimport { AlertController, IonicPage, NavController, NavParams } from 'ionic-angular';\r\nimport { Storage } from '@ionic/storage';\r\nimport firebase from 'firebase';\r\n/**\r\n * Generated class for the ValidarFacturasPage page.\r\n *\r\n * See https://ionicframework.com/docs/components/#navigation for more info on\r\n * Ionic pages and navigation.\r\n */\r\n\r\n@IonicPage()\r\n@Component({\r\n  selector: 'page-validar-facturas',\r\n  templateUrl: 'validar-facturas.html',\r\n})\r\nexport class ValidarFacturasPage {\r\n  public base64Image: string;\r\n  id : string;\r\n  nombre : String;\r\n  valor : number;\r\n  factura : Factura;\r\n  nombreCliente: string;\r\n  estado: string;\r\n  url: string;\r\n  almacen: string;\r\n  infoFactura$: FirebaseListObservable<Factura[]>\r\n  infoPerfil$: FirebaseListObservable<any[]>\r\n  usuario: FirebaseObjectObservable<any>;\r\n  puntos: FirebaseObjectObservable<any>;\r\n  puntosacum :number;\r\n  constructor(public navCtrl: NavController,\r\n    public firebaseService: FirebaseServicePrivider, \r\n    public navParams: NavParams,\r\n    private database: AngularFireDatabase,\r\n    public alertCtrl : AlertController,\r\n    public storage: Storage\r\n  ) {\r\n      let storageRef = firebase.storage().ref();\r\n      this.infoFactura$ = this.database.list('factura');\r\n      this.infoPerfil$ = this.database.list('perfil');\r\n      this.factura = navParams.get('factura');\r\n      this.id = navParams.get('id');\r\n      this.usuario=this.firebaseService.getUserName(this.factura.uid);\r\n      this.puntos=this.firebaseService.getUserName(this.factura.uid);\r\n      this.puntos.subscribe(nombreCliente=>{\r\n        this.nombreCliente = nombreCliente.nombre + \" \"+ nombreCliente.apellido;\r\n      });\r\n      this.nombreCliente = this.factura.uid;\r\n      this.estado = this.factura.estado;\r\n      this.url = this.factura.url;\r\n      this.almacen = this.factura.almacen;\r\n      \r\n\r\n      const imageRef = storageRef.child(this.url);\r\n      imageRef.getDownloadURL().then(url =>\r\n      this.base64Image = url);\r\n        \r\n      this.puntosacum = 0;\r\n      \r\n  }\r\n\r\n  ionViewDidLoad() {\r\n    this.storage.get('nombre').then((data)=>{\r\n      this.nombre=data;\r\n     });\r\n   this.puntos.subscribe( usersnapshot => {\r\n    this.puntosacum = parseInt(usersnapshot.puntos)\r\n  })\r\n  }\r\n\r\n  aprobar(){\r\n    \r\n    if(this.valor > 0){\r\n    console.log(\"numero valr: \"+ this.valor);\r\n    let alert = this.alertCtrl.create({\r\n      title: 'Confirmación',\r\n      subTitle: \"¿\"+ this.nombre +\" está seguro de  APROBAR ésta factura?\",\r\n      buttons:[\r\n        {\r\n          text: 'Si',\r\n          role: 'si',\r\n          handler: () => {\r\n            console.log('si');\r\n            // va el codigo que debe actualizar el estado de la \r\n            //factura  a \"aprobada\" y sumar los puntos al cliente \r\n            //y enviar notificacion\r\n            // se decide que por cada 1000 pesos de valor de la \r\n            //factura se ortoga 1 punto al cliente\r\n            this.factura.estado = 'Aprobada';\r\n            \r\n            this.infoFactura$.update( this.id, {\r\n              \r\n                      estado: this.factura.estado,\r\n                      valor: this.valor\r\n                                 \r\n                  })\r\n            this.puntosacum = Number(this.puntosacum) + Number(this.valor/1000);\r\n            this.infoPerfil$.update( this.factura.uid, {\r\n              puntos: this.puntosacum\r\n            })\r\n            this.navCtrl.setRoot('FacturasAprobadasPage');\r\n          }\r\n        },\r\n        {\r\n          text: 'No',\r\n          role: 'no',\r\n          handler: () => {\r\n            //la ventana de confirmacion solo se cierra\r\n          }\r\n        }\r\n      ]\r\n    });\r\n    alert.present();\r\n  }\r\n  else{\r\n    let alert = this.alertCtrl.create({\r\n      title: 'Error',\r\n      subTitle: \"El valor de la factura debe ser mayor a cero\",\r\n      buttons: ['Aceptar']\r\n    });\r\n    alert.present();\r\n  }\r\n  }\r\n\r\n  denegar(){\r\n\r\n    let alert = this.alertCtrl.create({\r\n      title: 'Confirmación',\r\n      subTitle: \"¿\"+ this.nombre +\" está seguro de DENEGAR ésta factura?\",\r\n      buttons:[\r\n        {\r\n          text: 'Si',\r\n          role: 'si',\r\n          handler: () => {\r\n            console.log('si');\r\n            // va el codigo que debe actualizar el estado de la \r\n            //factura  a \"denegada\"  \r\n            //y enviar notificacion\r\n            this.factura.estado = 'Denegada';\r\n            \r\n            this.infoFactura$.update( this.id, {\r\n              \r\n                      estado: this.factura.estado\r\n                                 \r\n                  })\r\n\r\n            this.navCtrl.setRoot('FacturasDenegadasPage');\r\n          \r\n          }\r\n        },\r\n        {\r\n          text: 'No',\r\n          role: 'no',\r\n          handler: () => {\r\n            //la ventana de confirmacion solo se cierra\r\n          }\r\n        }\r\n      ]\r\n    });\r\n    alert.present();\r\n\r\n  }\r\n\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./src/pages/validar-facturas/validar-facturas.ts"],"sourceRoot":""}